<!doctype html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<title>Basement Sensor</title>
</head> 
<body>
<h1 align="center">Basement Sensor</h1>
<hr>

<h2>{{data}}</h2>

{% if motion is defined %}
<h2>Motion Sensor: {{motion}}</h2>
{%endif%}

<h2 id="timer"></h2>
<label><input type="checkbox"  id="chkRefresh"/>Autorefresh</label>

<h2>Recent Sensor History</h2>

<table class="table table-bordered table-hover">  
<tr>     
        <td>Temperature</td> 
        <td>Humidity</td> 
</tr>
 
{%for i in results%} 
<tr>
    <td>{{i[1]}}</td> 
    <td>{{i[2]}}</td> 
{%endfor%}   
</tr> 
  
</table> 
<h2>Lowest Recorded Temp: {{sqlMaxMinRes[1][1]}}</h2>
<script>
var btn = document.getElementById('chkRefresh');
var countdownTimer;
var timer = document.getElementById('timer');

function startTimer(chkRefresh) {
    var numOfSeconds = 300; 
    timer.style.display = "block";
    countdownTimer = setInterval(function() {
        numOfSeconds = numOfSeconds - 1;
        timer.textContent = "Refreshing in " + numOfSeconds + " seconds";
		 if (numOfSeconds <= 0) {
                   timer.textContent = "Updating...";
		   location.reload(); 
                   timer.style.display =  "block";
		   clearInterval(countdownTimer);
		   startTimer(chkRefresh);
        }   
    }, 1000);
}


$('#chkRefresh').click(function(e){
        var timer = document.getElementById('timer');
	if(e.target.checked) {
  	localStorage.checked = true;
         var timer = setTimeout('startTimer();', 120);
  } else {
  	localStorage.checked = false;
        clearTimeout(countdownTimer);
        timer.style.display = "none";
  }
})

$( document ).ready(function() {
        var timer = document.getElementById('timer');
	document.querySelector('#chkRefresh').checked = localStorage.checked
        console.log(btn.checked)
        if(btn.checked){
            var timer = setTimeout('startTimer();', 120);
        }else{
             localStorage.checked = false;
             clearTimeout(countdownTimer);
	     timer.style.display = "none";
         }
});

</script>
</body>
</html>
